{% extends "layout.html" %}
{% block title %}{{ chapter }}{% endblock %}
{% block content %}
<div id="chapter_page">
  <div id="chapter_area">
    <h1>{{ folder }} / {{ chapter }}</h1>
    <p>
      <a href="/folder/{{ folder }}/{{ chapter }}/chapter.docx" download="{{ chapter }}.docx">Download Chapter</a>
    </p>
    <form action="/folder/{{ folder }}/{{ chapter }}/save" method="post" onsubmit="prepareChapter()">
      <div class="toolbar">
        <button type="button" onclick="execCmd('bold')">B</button>
        <button type="button" onclick="execCmd('italic')">I</button>
        <button type="button" onclick="execCmd('underline')">U</button>
        <button type="button" onclick="execCmd('indent')">Indent</button>
        <button type="button" onclick="execCmd('outdent')">Outdent</button>
      </div>
      <div id="chapter_editor" contenteditable="true">{{ chapter_html|safe }}</div>
      <input type="hidden" name="text" id="chapter_text" />
      <button type="submit">Save Chapter</button>
    </form>
    <form action="/folder/{{ folder }}/{{ chapter }}/delete" method="post" onsubmit="return confirm('Delete this chapter?');">
      <button type="submit">Delete Chapter</button>
    </form>
  </div>
  <div id="notes_sidebar">
    <p>Words: <span id="word_count">0</span></p>
    <h2>Notes</h2>
    {% if notes_text %}
    <p><a href="/folder/{{ folder }}/{{ chapter }}/{{ chapter|replace(' ', '_') }}_notes.txt">Download Notes</a></p>
    {% endif %}
    <form action="/folder/{{ folder }}/{{ chapter }}/notes/save" method="post">
      <textarea id="notes_editor" name="notes">{{ notes_text }}</textarea>
      <button type="submit">Save Notes</button>
    </form>
  </div>
</div>
{% endblock %}
