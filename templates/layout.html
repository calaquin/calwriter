<!doctype html>
<html>
<head>
  <title>{% block title %}{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="{{ url_for('static', filename='editor.js') }}"></script>
</head>
<body class="{% if app_settings.dark_mode %}dark{% endif %}" style="--sidebar-bg: {{ app_settings.sidebar_color }}; --text-color: {{ app_settings.text_color }}; --bg-color: {{ app_settings.bg_color }}">
<div id="sidebar">
  <a href="{{ url_for('index') }}">Home</a>
  <a href="{{ url_for('app_settings_page') }}">App Settings</a>
  <a href="{{ url_for('about_page') }}">About</a>
  <form action="{{ url_for('search') }}" method="get" id="search_form">
    <input type="text" name="q" placeholder="Search" />
  </form>
  {% macro render_tree(path, level=0) %}
  {% set subs = list_subfolders(path) %}
  {% set chaps = list_chapters(path) %}
  {% set times = list_timelines(path) %}
  <li class="tree-item{% if subs or chaps or times %} collapsible{% endif %}{% if level == 0 %} book-root{% endif %}" data-path="{{ path }}">
    <div class="item-line">
      {% if subs or chaps %}<span class="toggle" onclick="toggleTree(this)"></span>{% endif %}
      <a href="/folder/{{ path }}">{{ path.split('/')[-1] }}</a>
    </div>
    {% if subs or chaps or times %}
    <ul>
      {% for s in subs %}
        {{ render_tree(path ~ '/' ~ s, level+1) }}
      {% endfor %}
      {% for c in chaps %}
        <li class="tree-item chapter-item"><a href="/folder/{{ path }}/chapter/{{ c }}">{{ c }}</a></li>
      {% endfor %}
      {% for t in times %}
        <li class="tree-item chapter-item"><a href="/folder/{{ path }}/timeline/{{ t }}">{{ t }}</a></li>
      {% endfor %}
    </ul>
    {% endif %}
  </li>
  {% endmacro %}

  <ul class="tree">
    {% for f in folders %}
      {{ render_tree(f, 0) }}
    {% endfor %}
  </ul>
</div>
<div id="main">
  {% with messages = get_flashed_messages() %}
  {% if messages %}
  <ul class="flashes">
    {% for msg in messages %}<li>{{ msg }}</li>{% endfor %}
  </ul>
  {% endif %}
  {% endwith %}
  {% block content %}{% endblock %}
</div>
</body>
</html>
